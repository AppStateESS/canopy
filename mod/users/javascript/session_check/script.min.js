var sess_pollInterval=30000;var sess_interval_id;$(window).load(function(){var a=new checkSession;a.initSession()});function checkSession(){var a=this;this.poll_interval=sess_pollInterval;this.expiration_minutes=sess_expirationMinutes;this.minutes_until_warning=sess_warningMinutes;this.last_activity;this.interval_id;this.now;this.diff;this.diff_mins;this.warning_shown=false;this.initSession=function(){this.last_activity=new Date();this.SetInterval();this.InitializeDecisionButtons();$(document).bind("keypress.session",function(b,c){a.KeyPressed(b,c)})};this.InitializeDecisionButtons=function(){$("#stay-logged-in").click(function(){a.StayLoggedIn();a.RemoveAlert()});$("#logged-it-out").click(function(){a.LogOut()})};this.RemoveAlert=function(){$("#session-warning-alert").remove()};this.SetInterval=function(){this.interval_id=setInterval(function(){a.CheckInterval()},a.poll_interval)};this.ClearInterval=function(){clearInterval(this.interval_id)};this.KeyPressed=function(b,c){this.last_activity=new Date()};this.LogOut=function(){window.location.href="index.php?module=users&action=user&command=logout"};this.ResetDiffTime=function(){this.now=new Date();this.diff=this.now-this.last_activity;this.diff_mins=(this.diff/1000/60)};this.StayLoggedIn=function(){$("#stay-logged-in").click(function(){$.get("index.php");a.ResetDiffTime()})};this.InsertWarning=function(){var b=this.expiration_minutes-this.minutes_until_warning;var c='Your session will expire in <span id="timeout-countdown" style="font-weight:bold">'+b+' minutes</span>. <button class="btn btn-sm btn-success" id="stay-logged-in">Stay logged in</button>&nbsp;<button id="logged-it-out" class="btn btn-sm btn-danger">Logout</button>';$("body").prepend('<div id="session-warning-alert" class="text-center alert alert-danger">'+c+"</div>")};this.CheckInterval=function(){this.ResetDiffTime();if(this.diff_mins>=this.minutes_until_warning){if(a.warning_shown){var c=a.expiration_minutes-a.diff_mins;if(c>1){var b=Math.ceil(c)+" minutes";$("#timeout-countdown").html(b)}else{if(c>0){var d=Math.round(c*60);$("#timeout-countdown").html(d+" seconds")}else{a.RemoveAlert();alert("Your session has run out. Copy your work before trying to submit a form.");a.ClearInterval()}}}else{a.warning_shown=true;a.InsertWarning()}}}};